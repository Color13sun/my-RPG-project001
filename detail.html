<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>è‡ªä½œRPGè¨­å®šè³‡æ–™é›†ï½œè©³ç´°ãƒšãƒ¼ã‚¸</title>
        <meta name="description" content="ã‚µã‚¤ãƒˆæ¦‚è¦èª¬æ˜">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- [if lt IE 9] -->
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <!-- [endif] -->
        <!-- Google font setup -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Hachi+Maru+Pop&display=swap" rel="stylesheet">
        <!-- Google font set -->
        <link rel="stylesheet" href="styles.css">
        <script src="data.js"></script>
    </head>
<body>
    <header>
        ã€è‡ªä½œï¼²ï¼°ï¼§ï¼ˆã‚¿ã‚¤ãƒˆãƒ«æœªå®šï¼‰ã€‘ - è¨­å®šè³‡æ–™é›†
    </header>

    <div class="container">
        <a href="05glossary.html" class="back-link">â† ã‚¨ãƒ³ãƒˆãƒªä¸€è¦§ã«æˆ»ã‚‹</a> ğŸ ï¸
        <a href="00index.html" class="back-link">ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
        

        <div id="detail-content">
            <p>ã‚¨ãƒ³ãƒˆãƒªã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™...</p>
        </div>
    </div>

    <footer>
        &copy; 2025 ã€Color-sunã€‘ All Rights Reserved.
    </footer>

    <script>
        // ----------------------------------------------------
        // å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ã‚­ãƒ¼ã‚’æ—¥æœ¬èªè¡¨ç¤ºåã«å¤‰æ›ã™ã‚‹ãƒãƒƒãƒ—
        // ----------------------------------------------------
        const detailKeyMap = {
            // å¿…è¦ã«å¿œã˜ã¦ã‚­ãƒ¼ã¨æ—¥æœ¬èªè¡¨ç¤ºåã‚’è¿½åŠ ã—ã¦ãã ã•ã„
            'castra': 'é™£å–¶',
            'attributum': 'é­”æ³•å±æ€§',
            'magicum': 'åŸºæœ¬é­”æ³•',
            'affectiones': 'åŸºæœ¬æ„Ÿæƒ…',
            'munus': 'å½¹å‰²',
            'lex': 'æ³•å‰‡',
            'mana': 'é­”é‚£',
            'bellum': 'æ­¦è¡“',
            'telum': 'æ­¦å™¨',
            'fides': 'ä¿¡ä»°ã«ã¤ã„ã¦',
            'potestas': 'å¸ã‚‹åŠ›',
            'adventus': 'é™è‡¨ã«ã¤ã„ã¦',
            'belletcalam': 'å¤©ç©¹ã®çµ‚ç†„ï¼ˆå¯©åˆ¤ï¼‰ã«ã¤ã„ã¦',
            'sacraCaelum': 'è–å¤©æš¦ã«ã¤ã„ã¦',
            'ptolemaica': 'æ˜Ÿè¾°æš¦ã«ã¤ã„ã¦',
            'divisioMundi': 'ä¸–ç•Œã®åˆ†æ–­ã«ã¤ã„ã¦',
            '': '',
            '': '',
            '': '',
        };

        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰IDã‚’å–å¾—
        function getEntryIdFromUrl() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id'); 
        }

        // IDã«åŸºã¥ã„ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢
        function findEntryData(id) {
            // SETTING_DATAã¯data.jsã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™
            return SETTING_DATA.find(item => item.id === id);
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’HTMLã«åæ˜ ã•ã›ã‚‹ãƒ¡ã‚¤ãƒ³é–¢æ•°
        function renderDetailPage() {
            const entryId = getEntryIdFromUrl();
            const data = findEntryData(entryId);
            const contentDiv = document.getElementById('detail-content');

            if (!data) {
                contentDiv.innerHTML = 
                    '<h1>ã‚¨ãƒ©ãƒ¼: ã‚¨ãƒ³ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h1><p>æŒ‡å®šã•ã‚ŒãŸè¨­å®šè³‡æ–™ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚</p>';
                document.title = "ã‚¨ãƒ©ãƒ¼";
                return;
            }

            // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’å˜èªåã«è¨­å®š
            document.title = `è¨­å®šè³‡æ–™ - ${data.word}`;
            
            // ------------------------------------
            // HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å‹•çš„ã«ç”Ÿæˆ
            // ------------------------------------
            
            // --- å˜ä¸€ãƒ‡ãƒ¼ã‚¿ (details) ã®å‡¦ç† ---
            let detailItems = '';
            
            Object.entries(data.details).forEach(([key, value]) => {
                if (key === 'fullDescription' || key === 'image') return; 

                const displayKey = detailKeyMap[key] || key; 
                detailItems += `<dt>${displayKey}</dt><dd>${value}</dd>`;
            });

            // --- è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ (detailsArray) ã®å‡¦ç† ---
            if (data.detailsArray) {
                Object.entries(data.detailsArray).forEach(([key, [valueArray, delimiter]]) => {
                    if (!Array.isArray(valueArray) || valueArray.length === 0) return;

                    const displayKey = detailKeyMap[key] || key; 
                    
                    // é…åˆ—ã‚’çµåˆã—ã€<dd>ã‚¿ã‚°ã‚’ä¸€ã¤ç”Ÿæˆ (delimiter: <br>ã¾ãŸã¯ / ãªã©)
                    const combinedValue = valueArray.join(delimiter);
                    
                    detailItems += `<dt>${displayKey}</dt><dd>${combinedValue}</dd>`;
                });
            }
            /*
            // detailså†…ã®ãã®ä»–ã®æƒ…å ±ã‚’dt/ddã¨ã—ã¦æ•´å½¢
            const detailItems = Object.entries(data.details).map(([key, value]) => {
                // fullDescriptionã¨imageã¯ã“ã“ã§é™¤å¤–ã—ã€å¾Œã§å€‹åˆ¥ã«è¡¨ç¤º
                if (key === 'fullDescription' || key === 'image') return ''; 

                // ãƒãƒƒãƒ—ã‚’ä½¿ã£ã¦æ—¥æœ¬èªã®è¡¨ç¤ºåã‚’å–å¾—ã€‚ãƒãƒƒãƒ—ã«ãªã„å ´åˆã¯å…ƒã®ã‚­ãƒ¼ã‚’ä½¿ç”¨
                const displayKey = detailKeyMap[key] || key; 

                // â˜…ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ2: value ãŒé…åˆ—ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯â˜…
                if (Array.isArray(value)) {
                    // å€¤ãŒé…åˆ—ã®å ´åˆã€é…åˆ—ã®å„è¦ç´ ã«å¯¾ã—ã¦ <dd> ã‚’ç”Ÿæˆ
                    const ddItems = value.map(item => `<dd>${item}</dd>`).join('');
            
                    // æœ€åˆã® <dd> ã®å‰ã« <dt> ã‚’ä¸€ã¤ã ã‘è¿½åŠ ã—ã€æ®‹ã‚Šã® <dd> ã¯ <dt> ã®å¾Œã«ç¶šã‘ã‚‹
                    return `<dt>${displayKey}</dt>${ddItems}`;
                } else {
                    // å€¤ãŒæ–‡å­—åˆ—ï¼ˆã¾ãŸã¯å˜ä¸€ã®å€¤ï¼‰ã®å ´åˆã€é€šå¸¸é€šã‚Š <dt> ã¨ <dd> ã‚’ä¸€ã¤ãšã¤ç”Ÿæˆ
                    return `<dt>${displayKey}</dt><dd>${value}</dd>`;
                }
            }).join('');
            */
            const formattedDate = new Date(data.updatedAt).toLocaleDateString('ja-JP', { 
                year: 'numeric', month: '2-digit', day: '2-digit'
            });

            // ------------------------------------
            // è¡¨ (stats) ã®HTMLã‚’ç”Ÿæˆã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯â˜…
            // ------------------------------------
            let statsTableHtml = '';
    
            // ãƒ‡ãƒ¼ã‚¿ï¼ˆstatsï¼‰ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆstatHeadersï¼‰ã®ä¸¡æ–¹ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (data.stats && data.stats.length > 0 && data.statHeaders && data.statHeaders.length > 0) {
                
                // 1. ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ç”Ÿæˆ
                const headerRow = data.statHeaders.map(header => 
                    `<th>${header}</th>`
                ).join('');

                // 2. ãƒ‡ãƒ¼ã‚¿è¡Œã‚’ç”Ÿæˆ
                // å„ãƒ‡ãƒ¼ã‚¿é…åˆ— (ä¾‹: [15, "HP", 1250]) ã‚’HTMLã®<td>ã®è¡Œã«å¤‰æ›
                const tbodyContent = data.stats.map(statRow => {
                    // ãƒ‡ãƒ¼ã‚¿è¡Œå†…ã®å„è¦ç´ ã‚’<td>ã‚¿ã‚°ã«å¤‰æ›
                    const cells = statRow.map(cellData => 
                        `<td>${cellData !== null ? cellData : ''}</td>` // nullã¯ç©ºæ¬„ã«
                    ).join('');
                    return `<tr>${cells}</tr>`;
                }).join('');

                // 3. å…¨ä½“ã‚’çµ„ã¿ç«‹ã¦
                statsTableHtml = `
                    <table class="stats-table">
                        ${data.statTitle ? `<caption>${data.statTitle}</caption>` : ''}
                        <thead>
                            <tr>${headerRow}</tr>
                        </thead>
                        <tbody>
                            ${tbodyContent}
                        </tbody>
                    </table>
                `;
            }
            // ------------------------------------


            let html = `
                <h1>${data.word} (${data.reading})</h1>
                
                <div class="info-box">
                    ${data.details.image ? `<img src="${data.details.image}" alt="${data.word}ã®ç”»åƒ">` : '<div>[ç”»åƒãªã—]</div>'}
                    
                    <dl>
                        <dt>ã‚«ãƒ†ã‚´ãƒªãƒ¼</dt>
                        <dd>${data.category.join(' / ')}</dd>
                        <dt>æ¦‚è¦</dt>
                        <dd>${data.meaning.join('')}</dd>
                        <dt>æœ€çµ‚æ›´æ–°æ—¥</dt>
                        <dd>${formattedDate}</dd>
                        
                        <h2>åŸºæœ¬æƒ…å ±</h2>
                        ${detailItems}
                    </dl>
                    ${statsTableHtml}
                </div>
                
                <h2>èƒŒæ™¯ãƒ»è§£èª¬</h2>
                <p>${data.details.fullDescription.join('')}</p>
            `;

            contentDiv.innerHTML = html;
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«å®Ÿè¡Œ
        renderDetailPage();
    </script>
</body>
</html>